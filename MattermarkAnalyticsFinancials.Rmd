---
title: "Mattermark Analytics Financials"
author: "ML@B"
date: "4/20/2017"
output: 
  html_document:
    fig_height: 3
    fig_width: 5
---
<!-- Don't edit in between this line and the one below -->
```{r include=FALSE}
# Don't delete this chunk if you are using the DataComputing package
library(DataComputing)
```
*Source file* 
```{r, results='asis', echo=FALSE}
includeSourceDocuments()
```
<!-- Don't edit the material above this line -->

```{r}

#all available US stocks

Nasdaq <- read.csv("ftp://ftp.nasdaqtrader.com/SymbolDirectory/nasdaqlisted.txt", sep="|")
Nasdaq <- Nasdaq %>%
  select(Symbol, Security.Name)

Other <- read.csv("ftp://ftp.nasdaqtrader.com/SymbolDirectory/otherlisted.txt", sep="|")
Other <- Other %>%
  mutate(Symbol = ACT.Symbol) %>%
  select(Symbol, Security.Name)

PublicCompanies <- rbind(Nasdaq, Other)
```

```{r}
#mattermark data and functions to pull data

mattermark <- read.csv("C:/Users/darzo/Downloads/MattermarkAnalytics.csv")
mattermark <- filter(mattermark, mattermark$Stage == "Exited (ipo)")
mattermark <- filter(mattermark, mattermark$Test == TRUE)

mattermark$Ticker <- as.character(mattermark$Ticker)

companyFS <- 0

company2016Rev <- function(x){
  companyFS <- get(getFinancials(x))
  companyIS <- viewFinancials(companyFS, "IS", "A")
  return(companyIS[3,1])
}

company2016OI <- function(x){
  companyFS <- get(getFinancials(x))
  companyIS <- viewFinancials(companyFS, "IS", "A")
  return(companyIS[13,1])
}

company2016NI <- function(x){
  companyFS <- get(getFinancials(x))
  companyIS <- viewFinancials(companyFS, "IS", "A")
  return(companyIS[25,1])
}


```

```{r}

#generate list of financial information
list_of_revenue <- c()
list_of_operatingincome <- c()
list_of_netincome <- c()

for(i in 1:length(mattermark$Ticker)){
  list_of_revenue[i] <- company2016Rev(mattermark$Ticker[i])
  list_of_operatingincome[i] <- company2016OI(mattermark$Ticker[i])
  list_of_netincome[i] <- company2016NI(mattermark$Ticker[i])
}

publiccompanyfinancials <- data.frame(companyname, list_of_revenue, list_of_operatingincome, list_of_netincome)

write.csv(publiccompanyfinancials, file = "C:/Users/darzo/OneDrive/Documents/MattermarkAnalyticsFinancials.csv")

```

```{r}

#using tq_get, better for pulling stock data but need to unnest to view

#mattermarkcompanies <- mattermark$Ticker %>%
  #tq_get(get = "financials") %>%
  #filter(type == "IS")

```
